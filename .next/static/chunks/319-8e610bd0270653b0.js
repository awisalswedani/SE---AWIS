"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[319],{2302:(t,e,a)=>{a.d(e,{$g:()=>g,E1:()=>m,Jb:()=>y,O2:()=>s,P:()=>n,Pg:()=>T,Re:()=>_,Xl:()=>p,Yg:()=>w,as:()=>c,bE:()=>u,dt:()=>f,uW:()=>l,vp:()=>E,wH:()=>h,zj:()=>d});var o=a(9509);let r="https://awisapp.com/api/v1",i=o.env.NEXT_PUBLIC_SELLER_ID||o.env.SELLER_ID||"6";async function n(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];{if(!t){let t=localStorage.getItem("guest_id");if(t)return t}let e=await fetch("https://awisapp.com/api/v1/get-guest-id"),a=await e.json();if(a.guest_id)return localStorage.setItem("guest_id",a.guest_id.toString()),a.guest_id.toString();throw Error("No guest_id in backend response")}}async function s(){let t=await fetch("".concat(r,"/seller?seller_id=").concat(i),{headers:{"Content-Type":"application/json"},next:{revalidate:60}});if(!t.ok)throw Error("Failed to fetch seller info");return t.json()}async function c(){let t=await n(),e=await fetch("".concat(r,"/categories?seller_id=").concat(i,"&guest_id=").concat(t),{headers:{"Content-Type":"application/json"},next:{revalidate:60}});if(!e.ok)throw Error("Failed to fetch seller categories");return e.json()}async function l(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new URLSearchParams({guest_id:await n(),limit:t.limit||"20",offset:t.offset||"1",...t}).toString(),a=await fetch("".concat(r,"/seller/").concat(i,"/products?").concat(e),{headers:{"Content-Type":"application/json"},next:{revalidate:60}});if(!a.ok)throw Error("Failed to fetch products");let o=await a.json();return console.log("Products response:",o),o}async function d(){let t=await fetch("".concat(r,"/config"),{headers:{"Content-Type":"application/json"},next:{revalidate:60}});if(!t.ok)throw Error("Failed to fetch config");return t.json()}async function u(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,s={id:t,guest_id:await n(),quantity:e,buy_now:0};if(i&&(s.variant=i.type,s.price=i.price,s.sku=i.sku,s.qty=i.qty),a&&(i&&i.color_code?s.color=i.color_code:s.color=a),o){let t=1;for(let[e,a]of Object.entries(o))s["choice_".concat(t)]=a,t++}console.log("Adding to cart with data:",s);let c=await fetch("".concat(r,"/cart/add"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!c.ok){let t=await c.text();throw console.error("Add to cart failed:",c.status,t),Error("Failed to add to cart: ".concat(c.status," ").concat(t))}let l=await c.json();return console.log("Add to cart response:",l),l}async function p(){let t=await n();console.log("[DEBUG] getCart using guest_id:",t);let e=await fetch("".concat(r,"/cart?guest_id=").concat(t),{headers:{"Content-Type":"application/json"}});if(!e.ok){let t=await e.text();throw console.error("Get cart failed:",e.status,t),Error("Failed to fetch cart: ".concat(e.status," ").concat(t))}let a=await e.json();return console.log("[DEBUG] getCart result:",a),a}async function y(t,e){let a={cart_id:t,quantity:e,guest_id:await n()};console.log("Updating cart quantity with data:",a);let o=await fetch("".concat(r,"/cart/update"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!o.ok){let t=await o.text();throw console.error("Update cart failed:",o.status,t),Error("Failed to update cart: ".concat(o.status," ").concat(t))}let i=await o.json();return console.log("Update cart response:",i),i}async function f(t){let e={_method:"delete",guest_id:await n(),key:t};console.log("Removing from cart (Flutter style):",e);let a=await fetch("".concat(r,"/cart/remove"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){let t=await a.text();throw console.error("Remove from cart failed:",a.status,t),Error("Failed to remove from cart: ".concat(a.status," ").concat(t))}let o=await a.json();return console.log("Remove from cart response:",o),o}function g(t,e){if(!t||t<=0)return"";try{let r="KD",i=2,n=t;if(e){var a,o;let s=null==(a=e.currency_list)?void 0:a.find(t=>!0===t.status),c=null==(o=e.currency_list)?void 0:o.find(t=>!1===t.status&&"USD"===t.code);if(s){r=s.symbol||"KD";let e=parseFloat(s.exchange_rate)||1,a=parseFloat(null==c?void 0:c.exchange_rate)||1;n=t*e*(1/a)}i=e.decimal_point_settings||2}let s=n.toFixed(i).replace(/\B(?=(\d{3})+(?!\d))/g,",");return"".concat(r," ").concat(s)}catch(e){return console.error("Error formatting price:",e),"".concat(t.toFixed(2)," KD")}}async function h(t){let{guest_id:e,cartItems:a,shipping_cost:o,...r}=t;(!e||isNaN(Number(e)))&&(e=localStorage.getItem("guest_id")||"1");let i=new URLSearchParams({...Object.fromEntries(Object.entries(r).map(t=>{var e;let[a,o]=t;return[a,null!=(e=null==o?void 0:o.toString())?e:""]})),cartItems:JSON.stringify(a),guest_id:e.toString(),is_guest:"1",...void 0!==o?{shipping_cost:o.toString()}:{}}).toString(),n=await fetch("https://awisapp.com/api/v1/customer/order/place?".concat(i));if(!n.ok)throw Error("Failed to place order");return await n.json()}async function m(t){let e=t.guest_id;e||(e=await n());let a=t.latitude,o=t.longitude;(null==a||""===a)&&(a=0),(null==o||""===o)&&(o=0);let r={contact_person_name:t.name,address_type:t.address_type||"home",address:t.address,city:t.city,zip:t.postal||t.zip,phone:t.phone,state:t.state||"",country:t.country,latitude:a,longitude:o,is_billing:!1,guest_id:e.toString(),email:t.email||"",is_guest:1};console.log("[DEBUG] addAddress payload:",r);let i=await fetch("https://awisapp.com/api/v1/customer/address/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!i.ok)throw Error("Failed to add address");return await i.json()}async function _(t){let e=await fetch("https://awisapp.com/api/v1/customer/address/list?guest_id=".concat(encodeURIComponent(t.toString())));if(!e.ok)throw Error("Failed to fetch address list");let a=await e.json();return Array.isArray(a)?a:a.addresses||a.data||[]}function w(t){if(!t||0===t.length)return{sellerId:"1",sellerType:"admin"};let e=t[0];return{sellerId:e.seller_id||e.sellerId||"1",sellerType:e.seller_is||e.sellerIs||"admin"}}async function E(t,e,a){let o=await fetch("https://awisapp.com/api/v1/shipping-method/by-seller/1/admin?guest_id=".concat(a)),r=await o.json();return console.log("[DEBUG] getShippingMethods admin response:",r),Array.isArray(r)?r:r.shipping_methods||r.data||[]}async function T(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",o=await fetch("https://awisapp.com/api/v1/shipping-method/choose-for-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t,guest_id:e,cart_group_id:a})});if(!o.ok)throw Error("Failed to choose shipping method");return await o.json()}},7319:(t,e,a)=>{a.d(e,{_:()=>d,e:()=>l});var o=a(5155),r=a(2115),i=a(2302);let n={items:[],loading:!1,error:null,totalItems:0,subtotal:0,total:0};function s(t,e){switch(e.type){case"SET_LOADING":return{...t,loading:e.payload};case"SET_ERROR":return{...t,error:e.payload};case"SET_CART":return{...t,items:e.payload,totalItems:e.payload.reduce((t,e)=>t+e.quantity,0),subtotal:e.payload.reduce((t,e)=>t+(e.price-e.discount)*e.quantity,0),total:e.payload.reduce((t,e)=>t+(e.price-e.discount)*e.quantity,0)};case"ADD_ITEM":if(t.items.find(t=>t.product_id===e.payload.product_id)){let a=t.items.map(t=>t.product_id===e.payload.product_id?{...t,quantity:t.quantity+e.payload.quantity}:t);return{...t,items:a,totalItems:a.reduce((t,e)=>t+e.quantity,0),subtotal:a.reduce((t,e)=>t+(e.price-e.discount)*e.quantity,0),total:a.reduce((t,e)=>t+(e.price-e.discount)*e.quantity,0)}}{let a=[...t.items,e.payload];return{...t,items:a,totalItems:a.reduce((t,e)=>t+e.quantity,0),subtotal:a.reduce((t,e)=>t+(e.price-e.discount)*e.quantity,0),total:a.reduce((t,e)=>t+(e.price-e.discount)*e.quantity,0)}}case"UPDATE_ITEM":let a=t.items.map(t=>t.id===e.payload.id?{...t,quantity:e.payload.quantity}:t);return{...t,items:a,totalItems:a.reduce((t,e)=>t+e.quantity,0),subtotal:a.reduce((t,e)=>t+(e.price-e.discount)*e.quantity,0),total:a.reduce((t,e)=>t+(e.price-e.discount)*e.quantity,0)};case"REMOVE_ITEM":let o=t.items.filter(t=>t.id!==e.payload);return{...t,items:o,totalItems:o.reduce((t,e)=>t+e.quantity,0),subtotal:o.reduce((t,e)=>t+(e.price-e.discount)*e.quantity,0),total:o.reduce((t,e)=>t+(e.price-e.discount)*e.quantity,0)};case"CLEAR_CART":return{...t,items:[],totalItems:0,subtotal:0,total:0};case"UPDATE_TOTALS":return{...t,totalItems:t.items.reduce((t,e)=>t+e.quantity,0),subtotal:t.items.reduce((t,e)=>t+(e.price-e.discount)*e.quantity,0),total:t.items.reduce((t,e)=>t+(e.price-e.discount)*e.quantity,0)};default:return t}}let c=(0,r.createContext)(void 0);function l(t){let{children:e}=t,[a,l]=(0,r.useReducer)(s,n),[d,u]=r.useState(null);(0,r.useEffect)(()=>{localStorage.getItem("guest_id")||(localStorage.removeItem("guest_id"),l({type:"CLEAR_CART"}))},[]),(0,r.useEffect)(()=>{p()},[]);let p=async()=>{try{l({type:"SET_LOADING",payload:!0}),l({type:"SET_ERROR",payload:null});let t=await (0,i.Xl)();console.log("Cart response structure:",t);let e=[];Array.isArray(t)?e=t:t.cart&&Array.isArray(t.cart)?e=t.cart:t.items&&Array.isArray(t.items)?e=t.items:t.data&&Array.isArray(t.data)?e=t.data:(console.warn("Unexpected cart response structure:",t),e=[]),console.log("Processed cart items:",e),l({type:"SET_CART",payload:e})}catch(t){console.error("Failed to load cart:",t),l({type:"SET_ERROR",payload:"Failed to load cart"})}finally{l({type:"SET_LOADING",payload:!1})}},y=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;try{l({type:"SET_LOADING",payload:!0}),l({type:"SET_ERROR",payload:null}),console.log("Adding to cart:",{productId:t,quantity:e,selectedColor:a,selectedOptions:o,selectedVariant:r}),await (0,i.P)(),await (0,i.bE)(t,e,a,o,r),await p()}catch(t){throw console.error("Failed to add to cart:",t),l({type:"SET_ERROR",payload:"Failed to add to cart"}),u("Failed to add to cart"),t}finally{l({type:"SET_LOADING",payload:!1})}},f=async(t,e)=>{let o=a.items.find(e=>e.id===t);if(!o)return;let r=o.quantity;l({type:"UPDATE_ITEM",payload:{id:t,quantity:e}});try{l({type:"SET_ERROR",payload:null}),await (0,i.P)(),await (0,i.Jb)(t,e)}catch(e){throw l({type:"UPDATE_ITEM",payload:{id:t,quantity:r}}),l({type:"SET_ERROR",payload:"Failed to update quantity"}),u("Failed to update quantity"),e}},g=async t=>{let e=a.items.find(e=>e.id===t);if(e){l({type:"REMOVE_ITEM",payload:t});try{l({type:"SET_ERROR",payload:null}),await (0,i.P)(),await (0,i.dt)(t)}catch(t){throw l({type:"SET_CART",payload:[e,...a.items]}),l({type:"SET_ERROR",payload:"Failed to remove from cart"}),u("Failed to remove from cart"),t}}};return(0,o.jsxs)(c.Provider,{value:{state:a,addToCart:y,updateQuantity:f,removeFromCart:g,clearCart:()=>{l({type:"CLEAR_CART"})},loadCart:p,clearCartAndGuestId:()=>{localStorage.removeItem("guest_id"),l({type:"CLEAR_CART"})}},children:[e,d&&(0,o.jsxs)("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-4 py-2 rounded shadow z-50",children:[d,(0,o.jsx)("button",{className:"ml-2",onClick:()=>u(null),children:"\xd7"})]})]})}function d(){let t=(0,r.useContext)(c);if(void 0===t)throw Error("useCart must be used within a CartProvider");return t}}}]);