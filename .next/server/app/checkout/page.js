(()=>{var e={};e.id=279,e.ids=[279],e.modules={277:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var r=t(687),a=t(3210),l=t(169),n=t(7327),i=t(5814),o=t.n(i);async function d(e,s=5,t=300){for(let r=0;r<s;r++){let s=await (0,n.Re)(e);if(console.log(`Retry ${r+1}: fetched address list:`,s),Array.isArray(s)&&s.length>0){let e=[...s].sort((e,s)=>(s.id||0)-(e.id||0));console.log("Sorted address list:",e);let t=e[0].id||e[0].address_id;return console.log("Selected address_id:",t),t}await new Promise(e=>setTimeout(e,t))}return null}function c(){let{state:e,clearCart:s}=(0,l._)(),[t,i]=(0,a.useState)(1),[c,m]=(0,a.useState)({name:"",phone:"",email:"",country:"Kuwait",city:"",postal:"",address:"",addressType:"دائم"}),[u,p]=(0,a.useState)(""),[h,x]=(0,a.useState)(0),[g,b]=(0,a.useState)([]),[f,y]=(0,a.useState)(!1),[j,v]=(0,a.useState)(""),[w,N]=(0,a.useState)(!1),[_,k]=(0,a.useState)(null),[E,S]=(0,a.useState)(null),[P,C]=(0,a.useState)(null),[D,B]=(0,a.useState)([]),[G,q]=(0,a.useState)(!0),[U,A]=(0,a.useState)(null),[L,R]=(0,a.useState)(null),[$,T]=(0,a.useState)(!0),[M,O]=(0,a.useState)(null),[z,F]=(0,a.useState)(null),[W,X]=(0,a.useState)(!1),[H,I]=(0,a.useState)([]),[K,J]=(0,a.useState)(!0),[Q,V]=(0,a.useState)(null),[Y,Z]=(0,a.useState)(null),ee=()=>1===t?["name","phone","email","country","city","postal","address"].every(e=>""!==c[e].trim()):2===t?!!u:3!==t||!!j,es=async()=>{k(null);try{if(!ee())throw Error("يرجى تعبئة جميع الحقون المطلوبة");i(2)}catch(e){k(e.message||"حدث خطأ أثناء إضافة العنوان")}},et=async()=>{try{if(N(!0),k(null),S(null),console.log("[DEBUG] handlePayment called",{delivery:u,payment:j,guestId:L,guestIdLoading:$,items:e.items}),!u)throw Error("يرجى اختيار طريقة التوصيل");if(!j)throw Error("يرجى اختيار طريقة الدفع");if(!e.items.length)throw Error("السلة فارغة");if($||!L)throw Error("يرجى الانتظار حتى يتم تجهيز الحساب المؤقت");let t=await (0,n.E1)({name:c.name,phone:c.phone,email:c.email,country:c.country,city:c.city,postal:c.postal,address:c.address,address_type:c.addressType,guest_id:L}),r=t.address_id||t.id||t.data?.id;if(r||(r=await d(L)),console.log("[DEBUG] Got address_id:",r),!r)throw Error("فشل حفظ العنوان. يرجى المحاولة مرة أخرى.");let a=await (0,n.Xl)();if(console.log("[DEBUG] Cart before shipping selection (order):",a),!Array.isArray(a)||0===a.length){k("السلة فارغة أو لم يتم مزامنتها مع الخادم بعد. يرجى إضافة منتجات وإعادة المحاولة."),N(!1);return}let l="default";if(a[0].cart_group_id&&(l=a[0].cart_group_id),console.log("[DEBUG] Using cart_group_id for shipping (order):",l),await (0,n.Pg)(u,L,l),console.log("[DEBUG] Shipping method chosen (order):",u,"cart_group_id:",l),"cod"!==j){let e={order_note:"",customer_id:L,address_id:r,billing_address_id:r,coupon_code:"",coupon_discount:"",payment_method:j,is_check_create_account:!1,password:"",payment_platform:"web",payment_request_from:"app",guest_id:L,is_guest:!0,external_redirect_link:"https://awisapp.com/web-payment?flag=success&&token={token}"};console.log("[DEBUG] Digital payment payload:",e);let s=await fetch("https://awisapp.com/api/v1/digital-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"});if(console.log("[DEBUG] Response status:",s.status),!s.ok){let e=await s.text();throw console.error("[DEBUG] Backend error response:",e),Error(`Backend error: ${s.status} ${s.statusText}`)}if(s.redirected){console.log("[DEBUG] Response was redirected to:",s.url),window.location.href=s.url;return}let t=await s.json();if(console.log("[DEBUG] Digital payment response:",t),t&&t.redirect_link)console.log("[DEBUG] Redirecting to payment gateway:",t.redirect_link),window.location.href=t.redirect_link;else{let e=t&&"object"==typeof t&&"message"in t?t.message:String(t);throw Error("No redirect_link received from backend! Error: "+e)}return}let o={address_id:r,delivery:u,payment:j,order_note:"",cartItems:e.items.map(e=>({product_id:e.product_id,quantity:e.quantity,variant:e.variant,color:e.color||void 0})),guest_id:L,country:c.country,city:c.city,postal:c.postal,phone:c.phone,name:c.name,address:c.address,email:c.email,shipping_cost:h};console.log("[DEBUG] placeOrder payload:",o);let m=await (0,n.wH)(o);console.log("[DEBUG] placeOrder response:",m),S("تم إرسال الطلب بنجاح!"),s(),i(4)}catch(e){e&&e.message?(k(e.message),console.error("[DEBUG] handlePayment error:",e.message)):(k("حدث خطأ أثناء الشراء"),console.error("[DEBUG] handlePayment error: unknown"))}finally{N(!1)}};return $||!L?(0,r.jsx)("div",{className:"text-center text-lg py-10",children:"جاري تجهيز الحساب المؤقت للزائر..."}):M?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-red-100",children:(0,r.jsx)("div",{className:"text-red-600 text-lg",children:M})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",dir:"rtl",children:[(0,r.jsx)("header",{className:"bg-white shadow-sm",children:(0,r.jsx)("div",{className:"max-w-2xl mx-auto px-4",children:(0,r.jsxs)("div",{className:"relative flex items-center py-2 border-b border-gray-100 min-h-[48px]",children:[1===t?(0,r.jsx)(o(),{href:"/cart","aria-label":"Back to cart",className:"absolute left-0 top-1/2 -translate-y-1/2 inline-flex items-center justify-center w-9 h-9 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors shadow-sm focus:outline-none focus:ring-2 focus:ring-[#991b1b]",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-[#991b1b]",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}):(0,r.jsx)("button",{type:"button",onClick:()=>i(1),"aria-label":"Back to address",className:"absolute left-0 top-1/2 -translate-y-1/2 inline-flex items-center justify-center w-9 h-9 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors shadow-sm focus:outline-none focus:ring-2 focus:ring-[#991b1b]",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-[#991b1b]",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),(0,r.jsx)("h1",{className:"mx-auto text-xl font-bold text-gray-900 truncate max-w-xs md:max-w-lg text-center w-full",children:"الدفع"})]})})}),(0,r.jsxs)("main",{className:"max-w-2xl mx-auto px-4 py-8",children:[(0,r.jsx)(()=>(0,r.jsx)("div",{className:"flex justify-center gap-2 mb-8",children:[1,2].map(e=>(0,r.jsx)("div",{className:`w-8 h-2 rounded-full transition-all duration-300 ${t===e?"bg-blue-600 w-16":t>e?"bg-green-500":"bg-gray-300"}`},e))}),{}),1===t&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"معلومات العنوان"}),(0,r.jsxs)("form",{className:"space-y-4",onSubmit:e=>{e.preventDefault(),es()},children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block mb-1 font-medium",children:["اسم الشخص المسؤول ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{name:"name",value:c.name,onChange:e=>m({...c,name:e.target.value}),className:"w-full border rounded p-2",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block mb-1 font-medium",children:["هاتف ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{name:"phone",value:c.phone,onChange:e=>m({...c,phone:e.target.value}),className:"w-full border rounded p-2",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block mb-1 font-medium",children:["بريد إلكتروني ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{name:"email",value:c.email,onChange:e=>m({...c,email:e.target.value}),className:"w-full border rounded p-2",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block mb-1 font-medium",children:"نوع العنوان"}),(0,r.jsxs)("select",{name:"addressType",value:c.addressType,onChange:e=>m({...c,addressType:e.target.value}),className:"w-full border rounded p-2",children:[(0,r.jsx)("option",{value:"دائم",children:"دائم"}),(0,r.jsx)("option",{value:"مؤقت",children:"مؤقت"})]})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block mb-1",children:"الدولة"}),K?(0,r.jsx)("div",{children:"جاري تحميل قائمة الدول..."}):0===H.length?(0,r.jsx)("div",{className:"text-red-500",children:Q||"تعذر تحميل قائمة الدول."}):(0,r.jsxs)("select",{className:"input",value:c.country,onChange:e=>m({...c,country:e.target.value}),required:!0,children:[(0,r.jsx)("option",{value:"",children:"اختر الدولة"}),H.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]}),Q&&H.length>0&&(0,r.jsx)("div",{className:"text-red-500 text-sm mt-1",children:Q})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block mb-1 font-medium",children:["مدينة ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{name:"city",value:c.city,onChange:e=>m({...c,city:e.target.value}),className:"w-full border rounded p-2",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block mb-1 font-medium",children:["الرمز البريدي ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{name:"postal",value:c.postal,onChange:e=>m({...c,postal:e.target.value}),className:"w-full border rounded p-2",required:!0})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsxs)("label",{className:"block mb-1 font-medium",children:["عنوان ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{name:"address",value:c.address,onChange:e=>m({...c,address:e.target.value}),className:"w-full border rounded p-2",required:!0})]})]}),_&&(0,r.jsx)("div",{className:"text-red-600 text-center mt-2",children:_}),(0,r.jsx)("button",{type:"submit",className:"w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 transition-colors mt-4",disabled:W,children:W?"...جاري حفظ العنوان":"التالي"})]})]}),2===t&&(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),et()},children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"طريقة الشحن"}),f?(0,r.jsx)("div",{className:"text-center text-gray-500",children:"جاري تحميل خيارات الشحن..."}):0===g.length?(0,r.jsx)("div",{className:"text-center text-red-500",children:"لا توجد خيارات شحن متاحة حالياً لهذا البائع. جرب تحديث الصفحة أو التواصل مع الدعم."}):(0,r.jsx)("div",{className:"flex flex-col gap-4 mt-2",children:g.map((e,s)=>(0,r.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,r.jsx)("input",{type:"radio",name:"delivery",value:e.key||e.id||e.title,checked:u===(e.key||e.id||e.title),onChange:async()=>{p(e.key||e.id||e.title),x(Number(e.cost||0));try{if(L){let s=await (0,n.Xl)();if(!Array.isArray(s)||0===s.length)return void k("السلة فارغة أو لم يتم مزامنتها مع الخادم بعد. يرجى إضافة منتجات وإعادة المحاولة.");let t="default";s[0].cart_group_id&&(t=s[0].cart_group_id),await (0,n.Pg)(e.id,L,t)}}catch(e){k("تعذر حفظ طريقة الشحن المختارة. يرجى المحاولة مرة أخرى.")}}}),(0,r.jsx)("span",{children:e.title||e.name}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:e.duration?`مدة التوصيل: ${e.duration} أيام`:""}),(0,r.jsx)("span",{className:"ml-2 font-bold",children:void 0!==e.cost?`${e.cost} د.ك`:""})]},e.id||e.key||s))})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"طريقة الدفع"}),G?(0,r.jsx)("div",{children:"جاري تحميل طرق الدفع..."}):U?(0,r.jsx)("div",{style:{color:"red"},children:U}):(0,r.jsx)("div",{className:"flex gap-4 mt-2 flex-wrap items-center",children:D.map((e,s)=>(0,r.jsx)("label",{className:`flex-1 border rounded p-3 cursor-pointer min-w-[120px] ${j===(e.key||e.key_name)?"border-blue-600 bg-blue-50":"border-gray-200"} flex items-center gap-2`,children:(e.key||e.key_name)?.toLowerCase()==="fatoorah"?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{type:"radio",name:"payment",value:e.key||e.key_name,checked:j===(e.key||e.key_name),onChange:()=>v(e.key||e.key_name),className:"ml-2 order-1",disabled:G}),(0,r.jsx)("div",{className:"flex-1 flex justify-center order-2",children:(0,r.jsx)("img",{src:"/payment-logos.png",alt:"Fatoorah Payment Methods",className:"h-10 max-w-[180px] object-contain"})})]}):(0,r.jsxs)(r.Fragment,{children:[e.image&&(0,r.jsx)("img",{src:e.image,alt:e.name||e.label||"طريقة الدفع",className:"h-5 inline"}),e.name||e.label||e.key||e.key_name]})},e.key||e.name||s))})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"ملخص الطلب"}),0===e.items.length?(0,r.jsx)("div",{className:"text-gray-500",children:"السلة فارغة"}):(0,r.jsx)("ul",{className:"divide-y divide-gray-200 mb-4",children:e.items.map(e=>(0,r.jsxs)("li",{className:"py-2 flex justify-between items-center",children:[(0,r.jsxs)("span",{className:"text-sm",children:[e.name," \xd7 ",e.quantity]}),(0,r.jsx)("span",{className:"text-sm font-medium",children:(0,n.$g)((e.price-e.discount)*e.quantity,P)})]},e.id))}),(0,r.jsxs)("div",{className:"flex justify-between text-sm mb-1",children:[(0,r.jsx)("span",{children:"المجموع الفرعي"}),(0,r.jsx)("span",{children:(0,n.$g)(e.subtotal,P)})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm mb-1",children:[(0,r.jsx)("span",{children:"شحن"}),(0,r.jsx)("span",{children:(0,n.$g)(h,P)})]}),(0,r.jsxs)("div",{className:"border-t pt-3 flex justify-between text-lg font-semibold",children:[(0,r.jsx)("span",{children:"المجموع"}),(0,r.jsx)("span",{children:(0,n.$g)(e.subtotal+h,P)})]})]}),_&&(0,r.jsxs)("div",{className:"text-red-600 text-center mt-4 text-lg font-bold",children:["[خطأ]: ",_]}),(0,r.jsx)("button",{type:"submit",className:"w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 transition-colors text-lg font-bold mt-4",disabled:w||!j||G||f||!u,children:w?(0,r.jsx)("span",{className:"flex items-center justify-center",children:(0,r.jsxs)("svg",{className:"animate-spin h-6 w-6 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]})}):"cod"!==j?"ادفع الآن":"تأكيد الطلب"})]}),4===t&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6 text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-green-600 mb-4",children:"تم إرسال الطلب بنجاح!"}),(0,r.jsx)("p",{className:"mb-6",children:"شكراً لطلبك. سيتم التواصل معك قريباً."}),(0,r.jsx)(o(),{href:"/",className:"bg-blue-600 text-white py-2 px-6 rounded",children:"العودة للرئيسية"})]})]}),(0,r.jsx)("div",{className:"h-20 md:hidden"})]})}},440:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});var r=t(1658);let a=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,r.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1158:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>u,tree:()=>d});var r=t(5239),a=t(8088),l=t(8170),n=t.n(l),i=t(893),o={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);t.d(s,o);let d={children:["",{children:["checkout",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,4787)),"/Users/awis/Downloads/A-SELLER v1.2./public_html/seller-frontend/src/app/checkout/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,4431)),"/Users/awis/Downloads/A-SELLER v1.2./public_html/seller-frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,5284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/Users/awis/Downloads/A-SELLER v1.2./public_html/seller-frontend/src/app/checkout/page.tsx"],m={require:t,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/checkout/page",pathname:"/checkout",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},1262:(e,s,t)=>{Promise.resolve().then(t.bind(t,277))},1526:(e,s,t)=>{Promise.resolve().then(t.bind(t,4787))},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},4787:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/awis/Downloads/A-SELLER v1.2./public_html/seller-frontend/src/app/checkout/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/awis/Downloads/A-SELLER v1.2./public_html/seller-frontend/src/app/checkout/page.tsx","default")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9551:e=>{"use strict";e.exports=require("url")}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[447,881,658,351],()=>t(1158));module.exports=r})();